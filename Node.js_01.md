# 노드에 대해 알아보자



## 노드란 무엇일까?

>  노드(Node.js)는 자바스크립트를 이용해서 서버를 만들 수 있는 개발 도구이다.

## 노드의 탄생 배경

>  2009년 당시 웹 서버에 파일을 업로드할 때, 업로드가 완료되기 전까지 웹서버에서 데이터를 조회할 수 없었다. 이 문제를 해결하기 위해 만들어졌다.

## 노드의 비동기 입출력 방식

>  하나의 요청 처리가 끝날 때까지 기다리지 않고 다른 요청을 동시에 처리할 수 있는 방식인 비동기 입출력 방식을 적용했다.

## 동기 입출력 방식& 비동기 입출력 방식

>  비동기 입출력 방식을 이해하려면 동기 입출력 방식으로 파일을 읽는 과정을 알아야 한다.
>
>  PC에 있는 파일의 내용을 읽어로려면 파일 시스템에 읽기 요청을 한다. 이 때 파일 시스템에서는 디스크에 있는 파일을 확인하고 준비한 다음 처리하는 시간이 필요한데, 그동안 프로그램은 다른 작업을 진행하지 않고 대기하는 방식을 동기 입출력 방식이라고 한다.
>
>  이와 반대로 비동기 방식은 파일 시스템에 읽기 요청을 한 후에 프로그램에 대기하지 않고 다른 작업을 진행한다는 것이다.  
>
>  JS는 비동기 방식을 사용하기 위해서 콜백함수가 존재한다.

## 콜백함수(Callback Function)

>  JS에서는 변수에 함수를 할당할 수 있다. 따라서 변수에 할당된 함수를 다른 함수의 파라미터로 전달할 수 있다. 이렇게 파라미터로 전달된 함수를 다른 함수의 내부에서 호출하는 것이 콜백함수이다.

#### 동기 입출력 방식과 비동기 입출력 방식

##### 1. 동기 입출력 방식

```
var contents=file.read("a.txt");
<<<대기>>>
doshow(contents);
var result=doAdd(10,10)
```

>  file 객체가 파일을 나타내고 그 객체에 정의된 함수 중에서 파일을 읽어 들이는 함수를 read()라고 하면, file.read() 코드를 실행해서 파일의 내용을 읽어 올 수 있다. 이때 파일의 내용을 다 읽어 올 때까지 프로그램은 대기하고, 읽는 작업이 끝나야 파일의 내용을 화면에 보여주는 doShow()함수가 실행됩니다. 그리고 doAdd()함수는 마지막에 실행된다.

##### 2.비동기 입출력 방식

```
file.read('a.txt',function(contents){
  doShow(contents);
});
var result=doAdd(10,10);
```

>  반면에 비동기 방식은 file.read() 함수를 실행할 때 파일 이름뿐만 아니라 파일을 다 읽었을 때 실행할 함수도 파라미터로 전달한다. 파일 읽기를 요청한 다음에는 파일을 다 읽어 화면에 보여 주기 전이라도 doAdd()함수를 호출한다. 이 때문에 파일을 읽어 들이는 작업이 오래 걸리더라도 대기하지 않고 doAdd()함수를 먼저 실행할 수 있다.

#####  파일 읽기가 완료되었을 때 파일 시스템에서 콜백 함수를 호출하는데, 파일 시스템이 이벤트와 함께 호출하는 방식이면 이벤트 기방 입출력 모델이라고 부른다.

#####  노드는 비동기 방식을 상요하는 이벤트 기반 입출력 모델이다. 노드에서 사용하는 이 모델은 상당히 가볍고 효율적이며 많은 데이터를 주고받는 실시간 프로그램에서 큰 효과를 발휘할 수 있다.

### 노드에서 구현하는 이벤트 기반 입출력 방식

> JS는 코드를 한 줄씩 해석하면서 실행하는 인터프리터 방식을 사용하므로 속도가 느려 문제가 되곤 했다. 이러한 문제를 해결하기 위해서 크롬은 v8엔진을 만들었다. v8엔진은 JS코드를 네이티브코드로 바꾼 후 실행할 수 있기 때문에 코드를 빠르게 실행할 수 있었다. 
>
> 이러한 v8엔진에서 노드가 동작할 수 있도록 만든 시스템구조에서 가장 중요한 부분 중 하나가 이벤트를 받아 처리하는 기능이다. 특히 노든느 서버 족에서 동작하는 프로그램을 만든는 것이 주 임무이기 때문에 기본 기능인 소켓이나 HTTP 프로토콜을 사용해 데이터를 송수신하는 기능을 포함하고 있다. 따라서 데이터 송수신 부분에도 이벤트 처리 방식을 그대로 사용할 수 있다.

##### 다음은 http를 이용해서 웹서버로 요청을 보내고 응답을 받는 코드의 일부이다.

```
http.request(options,function(res){
  res.on('data',function(chuck)){
    console.log("BODY : "+chuck);
  };
});
```

> request() 함수를 호출하여 웹 서버에 데이터를 요청하고, 요청을 받으면 콜백함수가 자동으로 호출된다. 콜백함수는 res라는 이름의 객체를 전달받는데, 이 res객체는 수신한 데이터를 이벤트로 구별할 수 있다. 
>
> JS에서는 on() 메소드를 사용해 이벤트를 콜백 함수와 바인딩할 수 있다. 따라서 응답 객체인 res객체의 on() 메소드를 사용해 data 이벤트와 콜백 함수를 바인딩하면 data라는 이름의 이벤트를 받았을 때 등록한 콜백함수가 실행된다. 앞에는 이벤트 이름이 data라고 하면 응답으로 받은 데이터는 chuck 변수에 들어있다.

###### 출처 : Do it! Node.js프로그래밍

